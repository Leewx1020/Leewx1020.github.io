<html lang="en">
<head>
  <title>LAB6</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <link href='https://fonts.googleapis.com/css?family=Oswald:700' rel='stylesheet' type='text/css'>
</head>
<body>
	
<!-- Navigation -->
	<nav class="navbar navbar-inverse navbar-static-top" role="navigation">
	  <div class="container">
		<div class="navbar-header">
		  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
		  <ul class="nav navbar-nav">
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io">MainPage</a></li>
        <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab1.html">LAB 1</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab2.html">LAB 2</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab3.html">LAB 3</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab4.html">LAB 4</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab5.html">LAB 5</a></li>
        <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#about">LAB 6</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab7.html">LAB 7</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab8.html">LAB 8</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab9.html">LAB 9</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab10.html">LAB 10</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab11.html">LAB 11</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab12.html">LAB 12</a></li>
			  
			 	  
		  </ul>
		</div>
	  </div>
	</nav>
	
	

	      
	<div id="main_content_wrap" class="outer">
	<section id="main_content" class="inner">
	<article class="mb-4">
        <div class="container px-4 px-lg-5">
        <div class="row gx-4 gx-lg-5 justify-content-center">
        <div class="col-md-9 col-lg-9 col-xl-9">
		
		
		
	<h2>Lab 6 - Closed-loop Control(PID)</h2>
	
	<h3>Prelab</h3>
		<p>I create a new Arduino code file and combine the necessary code from lab2 and lab3 to get a good setup for the Bluetooth and the 
		ToF sensor. This is very similar to the task we did in lab 2. 
		I first define all the variable I need as a global variable at the very top of the Arduino code.
		The code screenshot is shown below. </p> 
	<img class="img-responsive" src="https://leewx1020.github.io/lab_pic/lab6/define.jpeg" alt=""width="500" height="500"/>
		<p>In this lab, I create three cases in the handler command section. 
		The first one is called "SET_VAL", which is shown below. This is helpful to set the Kp, Ki, and Kd values in the Jupyter notebook. 
		With this code, we do not need to upload the whole code to the Artemis board to test the PID value. </p>
	<img class="img-responsive" src="https://leewx1020.github.io/lab_pic/lab6/setvalue.jpeg" alt=""width="400" height="400"/>
		<p>The cases shown below are used to control the car moving and also send the data to the computer. 
		The case "PID_CONTROLL" is help to turn on the car and start to get the sensor distance and calculate the PMW value. 
		The case "DATA" is used to receive the data array from Artemis. But before that, I set the flag to false to stop the car first.</p>
	<img class="img-responsive" src="https://leewx1020.github.io/lab_pic/lab6/controll.jpeg" alt=""width="500" height="500"/>
		<p>Then in python code, we still need a notification handler to help to receive the data from Artemis. 
		But before that, we need to send the command with the command type "SET_VAL" to set the PID value and "PID_CONTROLL" to make the car start moving. 
		And then, the command type "DATA" can be run to store all the data monitored into array and ready to get the plot.</p>
	<img class="img-responsive" src="https://leewx1020.github.io/lab_pic/lab6/python.jpeg" alt=""width="500" height="500"/>
		
	<h3>PID Discussion</h3>
		<p>PID (proportional, integral, and derivative) control is a closed-loop control. 
		For the P control, the output will be proportional to the increase as the error increase. 
		P control only is useful when you want to design a controller quickly, but it is not perfect. 
		In my Arduino code. I can get the error by using the ToF sensor to get the current distance and use that to minus the target distance, 
		which is 300mm. Then, the output will be P*error. </p>
		<p>For the I (integral) control, this term seeks to eliminate the residual error by adding a control effect due to the historic cumulative 
		value of the error. It is used to sum the error over time, so a small error term can cause the response speed system to increase slowly. 
		Therefore, the purpose of the I controller is to tune the system to get a good reaction time. 
		In the Arduino code, I define the i_error and add every error term up during the time change, 
		which is "i_error = i_error + error*dt/1000", where the dt is current_time - last_time.</p>
		<p>For D (derivative) control, it calculates the rate of change of the error. 
		As the error change becomes larger, the derivative factor will become larger. 
		This D controller is helpful to deal with the overshoot generated by the P and I controller. 
		In the Arduino code, I use the current error to minus the previous error and all together divided it by the dt, 
		which is d_error = (error - prev_error)/(dt/1000). </p>
	<h3>Range/Sampling time Discussion</h3>
		
	<h3>Graphs, code, videos, images, discussion of reaching task goal</h3>	
		
	<img class="img-responsive" src="https://leewx1020.github.io/lab_pic/lab6/pid.jpeg" alt=""width="500" height="500"/>
	<img class="img-responsive" src="https://leewx1020.github.io/lab_pic/lab6/forward.jpeg" alt=""width="500" height="500"/>
	<img class="img-responsive" src="https://leewx1020.github.io/lab_pic/lab6/stop_back.jpeg" alt=""width="500" height="500"/>
		
	<img class="img-responsive" src="https://leewx1020.github.io/lab_pic/lab6/p2.jpeg" alt=""width="500" height="500"/>
	<img class="img-responsive" src="https://leewx1020.github.io/lab_pic/lab6/p1.jpeg" alt=""width="500" height="500"/>
		
	<h3>(5000) Wind-up implementation and discussion</h3>
		
	
