
<html lang="en">
<head>
  <title>LAB2</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <link href='https://fonts.googleapis.com/css?family=Oswald:700' rel='stylesheet' type='text/css'>
</head>
<body>
	
<!-- Navigation -->
	<nav class="navbar navbar-inverse navbar-static-top" role="navigation">
	  <div class="container">
		<div class="navbar-header">
		  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
		  <ul class="nav navbar-nav">
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io">MainPage</a></li>
        <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab1.html">LAB 1</a></li>
			  <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#about">LAB 2</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab3.html">LAB 3</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab4.html">LAB 4</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab5.html">LAB 5</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab6.html">LAB 6</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab7.html">LAB 7</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab8.html">LAB 8</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab9.html">LAB 9</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab10.html">LAB 10</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab11.html">LAB 11</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab12.html">LAB 12</a></li>
			  <li class="nav-item"><a class="nav-link" href="https://leewx1020.github.io/lab/lab13.html">LAB 13</a></li>
			 	  
		  </ul>
		</div>
	  </div>
	</nav>
	
	

	      
	<div id="main_content_wrap" class="outer">
	<section id="main_content" class="inner">
	<article class="mb-4">
        <div class="container px-4 px-lg-5">
        <div class="row gx-4 gx-lg-5 justify-content-center">
        <div class="col-md-9 col-lg-9 col-xl-9">
		
	<h2 id="lab-2">Lab 2-Bluetooth</h2>
	
	<h3 id="objective">Objective</h3>
		<p>In lab 2, we are required to be familiar with Bluetooth communication between the computer and the Artemis board. 
		To accomplish that, we use the Jupyter Notebook and Arduino programming language as a tool to send the message. 
			Here, we only need to do some basic practice to prepare for future lab usage.</p>
	
	<h3 id="Setup">Setup</h3>
		<p>To get started with lab 2, we have to do some environment setup. 
		First, use "Python3" in the terminal to check the python version and make sure it is >3.9. 
		Then, install venv and activate the virtual environment by sourcing it. 
		The last step is to install the python package and start the Jupyter Nootbook using command Jupyter lab.</p>
			
		<p>Now, we are ready to set the connection between the computer and the Artemis board. 
		The MAC address can be got by running the ble_arduino, which is shown below.</p>
		
	<img class="img-responsive" src="https://leewx1020.github.io/lab_pic/lab2/MAC address.jpeg"/>
		<p></p>
		<p>Then use the command provided to get a random UUID number.</p>
		
	<img class="img-responsive" src="https://leewx1020.github.io/lab_pic/lab2/UUID_generate.jpeg" alt=""width=400" height="400"/>
		<p>The next step is to use the UUID number generated above and the MAC address to replace the ble_uuid_test_service number 
		in ble_arduino and ble_service number and artemis_address in the "connection. yaml" file. 
		When running the command, it will keep searching the surrounding Bluetooth. 
		The same UUID number in "connection.yaml" and "ble_arduino" will automatically connect. </p>
	<img class="img-responsive" src="https://leewx1020.github.io/lab_pic/lab2/Arduino_change.jpeg" alt=""width="600" height="600"/>
	<img class="img-responsive" src="https://leewx1020.github.io/lab_pic/lab2/change_yaml.jpeg" alt=""width="600" height="600"/>
																  
		<p>Now, we are well prepared for the Bluetooth connection. First, run through the demo.ipynb to the Configuration part. 
		And then, the serial monitor will automatically show the connection. </p>
	<img class="img-responsive" src="https://leewx1020.github.io/lab_pic/lab2/demo_connect.jpeg" alt=""width="600" height="600"/>
	<img class="img-responsive" src="https://leewx1020.github.io/lab_pic/lab2/arduino_connect.jpeg" alt=""width="600" height="600"/>
						
																      
																      
	<h3 id="task-1-echo">Task 1: ECHO</h3>	
	<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
	* Your code goes here.
             */
             tx_estring_value.clear();
             tx_estring_value.append("Robot says->");
             tx_estring_value.append(char_arr);
             tx_estring_value.append(":)");
             tx_characteristic_string.writeValue(tx_estring_value.c_str());
             Serial.print(tx_estring_value.c_str());
            break;
        /*
	</code></pre></div></div>
		<p>The first task is required to send the string from the computer to the Artemis board and get the augmented string from 
		the board to the computer. I use the example command provided in ble_arduino, "tx_estring_value", to accomplish that. 
		And then, use the "append" syntax to add the required format. 
		In the end, the "tx_characteristic_string" is helpful to send the message to the Artemis board.  </p>
		<p>For the Python code, the most essential thing is to check the "cmd_type" file and add the cmd name. 
		The code in Arduino is shown above and the code in Python is shown below. </p>
	<img class="img-responsive" src="https://leewx1020.github.io/lab_pic/lab2/echo.jpeg" alt=""width="600" height="600"/>
	 
		
	
	<h3 id="task-2-get_time_millis">Task 2: GET_TIME_MILLIS</h3>
	<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
	case GET_TIME_MILLIS:
             tx_estring_value.clear();
             tx_estring_value.append("T:");
             tx_estring_value.append((int)millis());
             tx_characteristic_string.writeValue(tx_estring_value.c_str());
             break;
	</code></pre></div></div>
		<p>This task is required to get the current time from Artemis to the computer. 
		The method to achieve this is very similar to task one. The only difference is the data type. 
		The code in Arduino is shown above and the code in Python and the result is shown below. 
		The result is represented in milliseconds.</p>
	<img class="img-responsive" src="https://leewx1020.github.io/lab_pic/lab2/task2.jpeg" alt=""width="600" height="600"/>
		
			    
	<h3 id="task-3-notification-handler">Task 3: Notification Handler</h3>
		<p>In task 3, we are required to set the notification handler to receive the string value from Artemis. 
		It uses the callback function method to get the time. 
		After settling this function, we do not need to run the receive string and print command every time. 
		The only one we need is the "send_command".  The system will automatically print what you want. 
		The screenshot shown below is the callback function I got. It uses task 2 to prove the feasibility. </p>
	<img class="img-responsive" src="https://leewx1020.github.io/lab_pic/lab2/task3.jpeg" alt=""width="600" height="600"/>
		
		
	
	<h3 id="task-4-get-temp-5s">Task 4: GE_TEMP-5s</h3>
	<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
	case GET_TEMP_5s:
             tx_estring_value.clear();
             for (int i = 1; i <5; i++){
                tx_estring_value.append("T:");
                tx_estring_value.append((float)(millis()/1000));
                tx_estring_value.append("|C:");
                tx_estring_value.append(getTempDegC());
                if (i !=4){
                  tx_estring_value.append("|");
                }
                delay(1000);
             }
          tx_characteristic_string.writeValue(tx_estring_value.c_str());
		break;
	</code></pre></div></div>
		<p>In task 4, it is required to get the current temperature every second and last for 5 seconds. 
		I use the for loop to run 5 times in total, and for each loop, I set a delay for 1000 milliseconds(1 second). 
		Inside the loop, the algorithm is also similar to task 1. 
		I use the syntax "getTempDegC" to get the current temperature in the unit of Celcius. 
		The code in Arduino is shown above and the code in Python and the result is shown below. 
		Here, I still use the notification handler function I set up in task 3. 
		Therefore, same as the get time millis example, I can get what I want by using just one line command. 
		The result is represented in milliseconds and Celcius.</p>
	<img class="img-responsive" src="https://leewx1020.github.io/lab_pic/lab2/task4.jpeg" alt=""width="600" height="600"/>
		
		
		
	<h3 id="task-5-get-temp-5s-rapid">Task 5: GE_TEMP-5s_RAPID</h3>
		
		
		
		
	<h3 id="task-6">Task 6: </h3>
		
		
		
		
		
	<h3 id="additional-task-for-5000-level-student">Additional Task for 5000 Level Student</h3>
			    
	

		      
			
			
			
			
			
